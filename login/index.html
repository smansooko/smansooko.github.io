<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>LOGIN | PERUT SMANSASOO</title>

  <link href="MAEM.png" rel="icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>

<body>
  <div class="kotak">
    <div class="form-box login">
      <form id="loginForm">
        <h1>Login</h1>
        <div class="input-box">
          <input type="text" id="nisn" placeholder="NISN" required>
          <i class="fa-solid fa-user"></i>
        </div>
        <div class="input-box">
          <input type="password" id="password" placeholder="Tanggal lahir (ddmmyyyy)" required>
          <i class="fa-solid fa-lock"></i>
        </div>
        <!-- <div class="input-box">
          <select id="level" required>
            <option value="">Pilih Level</option>
            <option value="siswa">Siswa</option>
            <option value="kurir">Kurir</option>
          </select>
          <i class="fa-solid fa-users"></i>
        </div> -->
        <div class="forgot-link">
          <button type="submit" class="btn">Login</button>
        </div>
        <div>
          <a href="index.html" class="btn-ber">Kembali ke Beranda</a>
        </div>
      </form>
    </div>

    <div class="toogle-box">
      <div class="toogle-panel toogle-left">
        <h1>SELAMAT DATANG</h1>
        <h3>PERUT SMANSASOO</h3>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const nisn = document.getElementById("nisn").value.trim();
      const password = document.getElementById("password").value.trim();

      // if (!level) {
      //   alert("Pilih level terlebih dahulu.");
      //   return;
      // }

      try {
        let url = "";
        // if (level === "siswa") {
        //   url = "data_siswa.json";
        // } else if (level === "kurir") {
        //   url = "data_kurir.json";
        // }

        url = "data_pengguna.json";

        const response = await fetch(url);
        if (!response.ok) throw new Error("Gagal memuat data dari " + url);

        const data = await response.json();

        // JSON berisi array objek seperti: [{nisn:"123", password:"12345678", nama:"Dody", kelas:"XI-4"}]
        const user = data.find(u => String(u.nisn) === nisn && String(u.password) === password);

        if (!user) {
          alert("NISN atau password salah. Periksa kembali.");
          return;
        }

        // Simpan data login ke localStorage
        const level = user.level;
        localStorage.setItem("isLoggedIn", true);
        localStorage.setItem("role", level);
        localStorage.setItem("username", user.nama || "User");
        localStorage.setItem("nisn", user.nisn);
        localStorage.setItem("password", user.password);
        localStorage.setItem("kelas", user.kelas || "-");
        

        // Arahkan ke halaman sesuai level
        if (level === "siswa") {
          window.location.href = "index.html";
        } else if (level === "kurir") {
          window.location.href = "../front/kurir.html";
        }

      } catch (error) {
        console.error("Error login:", error);
        alert("Terjadi kesalahan saat login. Silakan coba lagi.");
      }
    });
  </script>

</body>

</html>